# ============================================================
# üìò –ü–†–û–ì–†–ê–ú–ú–ê: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—å—è–º –í–∏–∫–∏–ø–µ–¥–∏–∏
# üìå –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: Selenium + Firefox + GeckoDriver (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞)
# üß† –ê–≤—Ç–æ—Ä: N888
# ============================================================
"""
üß† –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
1. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–µ–º—É –¥–ª—è –ø–æ–∏—Å–∫–∞.
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å—Ç–∞—Ç—å—é –∏–∑ –í–∏–∫–∏–ø–µ–¥–∏–∏.
3. –ü–æ–∑–≤–æ–ª—è–µ—Ç:
    ‚Äî –ª–∏—Å—Ç–∞—Ç—å –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã —Ç–µ–∫—É—â–µ–π —Å—Ç–∞—Ç—å–∏;
    ‚Äî –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–ª—É—á–∞–π–Ω—É—é —Å–≤—è–∑–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É;
    ‚Äî –≤–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞;
    ‚Äî –≤—ã–π—Ç–∏ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã.
‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç GeckoDriver, –µ—Å–ª–∏ –æ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
"""

# --- –ò–º–ø–æ—Ä—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∏ —Å–µ—Ç–µ–≤—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ ---
import time               # –î–ª—è –∑–∞–¥–µ—Ä–∂–µ–∫ (–∏–º–∏—Ç–∞—Ü–∏—è ¬´—á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ¬ª –ø–æ–≤–µ–¥–µ–Ω–∏—è)
import random             # –î–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å—Å—ã–ª–æ–∫
import platform           # –ß—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–∏—Å—Ç–µ–º—ã (win32 –∏–ª–∏ win64)
import urllib.request     # –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥—Ä–∞–π–≤–µ—Ä–∞ –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ –±—É–¥–µ—Ç —Å–±–æ–π
import zipfile            # –î–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ zip-–∞—Ä—Ö–∏–≤–∞
import os                 # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—É—Ç—è–º–∏ –∏ —Ñ–∞–π–ª–∞–º–∏

# --- –ò–º–ø–æ—Ä—Ç Selenium –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞ GeckoDriver ---
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
import geckodriver_autoinstaller

# ==========================================================
# üîß –§–£–ù–ö–¶–ò–Ø 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ GeckoDriver
# ==========================================================
def setup_geckodriver():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ GeckoDriver –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –µ–≥–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ"""
    try:
        print("üîç –ü—Ä–æ–≤–µ—Ä—è—é –Ω–∞–ª–∏—á–∏–µ GeckoDriver...")
        geckodriver_autoinstaller.install()  # –ü—Ä–æ–≤–µ—Ä–∏—Ç –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –Ω—É–∂–Ω—É—é –≤–µ—Ä—Å–∏—é
        print("‚úÖ GeckoDriver —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!\n")
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ GeckoDriver: {e}")
        print("‚è¨ –ü—Ä–æ–±—É—é –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Ä—É—á–Ω—É—é...")

        try:
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–µ—Ä—Å–∏—é –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
            version = "v0.35.0"
            arch = "win64" if platform.machine().endswith("64") else "win32"
            url = f"https://github.com/mozilla/geckodriver/releases/download/{version}/geckodriver-{version}-{arch}.zip"
            file_name = "geckodriver.zip"
            urllib.request.urlretrieve(url, file_name)
            with zipfile.ZipFile(file_name, "r") as zip_ref:
                zip_ref.extractall(".")
            os.remove(file_name)
            print("‚úÖ GeckoDriver —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤—Ä—É—á–Ω—É—é!\n")
        except Exception as ex:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä—É—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ GeckoDriver: {ex}")
            print("üö® –ó–∞–≤–µ—Ä—à–∞—é –ø—Ä–æ–≥—Ä–∞–º–º—É. –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –ø–æ–≤—Ç–æ—Ä–∏ –ø–æ–ø—ã—Ç–∫—É.")
            exit()

# ==========================================================
# üîé –§–£–ù–ö–¶–ò–Ø 2. –ü–æ–∏—Å–∫ —Å—Ç–∞—Ç—å–∏ –Ω–∞ –í–∏–∫–∏–ø–µ–¥–∏–∏
# ==========================================================
def open_article(browser, query):
    """–û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—å—é –í–∏–∫–∏–ø–µ–¥–∏–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    base_url = "https://ru.wikipedia.org/wiki/"
    search_url = base_url + query.replace(" ", "_")  # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL
    browser.get(search_url)
    time.sleep(2)

    if "–í–∏–∫–∏–ø–µ–¥–∏—è" not in browser.title:
        print("‚ö†Ô∏è –ü–æ—Ö–æ–∂–µ, —Ç–∞–∫–æ–π —Å—Ç–∞—Ç—å–∏ –Ω–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å.")
        return False

    print(f"üìñ –û—Ç–∫—Ä—ã—Ç–∞ —Å—Ç–∞—Ç—å—è: {browser.title}\n")
    return True

# ==========================================================
# üìú –§–£–ù–ö–¶–ò–Ø 3. –ß—Ç–µ–Ω–∏–µ, –ª–∏—Å—Ç–∞–Ω–∏–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ —Å—Ç–∞—Ç—å–∏
# ==========================================================
def read_paragraphs(browser, query):
    """–í—ã–≤–æ–¥–∏—Ç –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã —Ç–µ–∫—É—â–µ–π —Å—Ç–∞—Ç—å–∏"""
    paragraphs = browser.find_elements(By.TAG_NAME, "p")
    if not paragraphs:
        print("‚ùå –ü–∞—Ä–∞–≥—Ä–∞—Ñ—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.")
        return

    print(f"üìú –õ–∏—Å—Ç–∞–µ–º –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã —Å—Ç–∞—Ç—å–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É: ¬´{query}¬ª")
    print("–ù–∞–∂–∏–º–∞–π Enter –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞ –∏–ª–∏ 'q' –¥–ª—è –≤—ã—Ö–æ–¥–∞.\n")

    for p in paragraphs:
        user_input = input(f"{p.text}\n\n‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (Enter / q): ")
        if user_input.lower() == "q":
            break

# ==========================================================
# üîó –§–£–ù–ö–¶–ò–Ø 4. –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å–≤—è–∑–∞–Ω–Ω—ã–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
# ==========================================================
def go_to_random_link(browser):
    """–ù–∞—Ö–æ–¥–∏—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –æ–¥–Ω—É —Å–ª—É—á–∞–π–Ω—É—é"""
    links = browser.find_elements(By.TAG_NAME, "a")
    valid_links = [a for a in links if a.get_attribute("href") and "/wiki/" in a.get_attribute("href")]

    if not valid_links:
        print("‚ùå –°–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.")
        return False
    chosen = random.choice(valid_links)
    link = chosen.get_attribute("href")
    print(f"üîó –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–≤—è–∑–∞–Ω–Ω—É—é —Å—Ç–∞—Ç—å—é: {link}\n")

    browser.get(link)
    time.sleep(2)
    print(f"üìò –¢–µ–ø–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–∞: {browser.title}\n")
    return True

# ==========================================================
# üß≠ –û–°–ù–û–í–ù–ê–Ø –ü–†–û–ì–†–ê–ú–ú–ê
# ==========================================================
def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
    setup_geckodriver()  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥—Ä–∞–π–≤–µ—Ä, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

    print("üåç –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Å–æ–ª—å–Ω—É—é –í–∏–∫–∏–ø–µ–¥–∏—é –Ω–∞ Python!")
    query = input("üîé –í–≤–µ–¥–∏ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞: ").strip()

    # –ó–∞–ø—É—Å–∫–∞–µ–º Firefox
    browser = webdriver.Firefox()
    browser.maximize_window()

    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç–∞—Ç—å—é ‚Äî –≤—ã—Ö–æ–¥–∏–º
    if not open_article(browser, query):
        browser.quit()
        return

    # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
    while True:
        print("\n‚ú® –ß—Ç–æ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ?")
        print("üÖê ‚Äî üìú –õ–∏—Å—Ç–∞—Ç—å –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã —Ç–µ–∫—É—â–µ–π —Å—Ç–∞—Ç—å–∏ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∑–∞–ø—Ä–æ—Å—É")
        print("üÖë ‚Äî üîó –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–ª—É—á–∞–π–Ω—É—é —Å–≤—è–∑–∞–Ω–Ω—É—é —Å—Ç–∞—Ç—å—é –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞")
        print("üÖí ‚Äî üß† –í–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞")
        print("üÖì ‚Äî üö™ –í—ã–π—Ç–∏ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã")

        action = input("üëâ –¢–≤–æ–π –≤—ã–±–æ—Ä (–ê/–ë/–í/–ì): ").lower()

        if action == "–∞":  # –õ–∏—Å—Ç–∞–µ–º –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã
            read_paragraphs(browser)
        elif action == "–±":  # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–≤—è–∑–∞–Ω–Ω—É—é —Å—Ç–∞—Ç—å—é
            if go_to_random_link(browser):
                continue
        elif action == "–≤":  # –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
            new_query = input("üß† –í–≤–µ–¥–∏ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞: ").strip()
            query = new_query  # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å
            if not open_article(browser, query):
                print("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å—Ç–∞—Ç—å—é –ø–æ –Ω–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É.")
        elif action == "–≥":  # –í—ã—Ö–æ–¥
            print("üëã –î–æ –≤—Å—Ç—Ä–µ—á–∏! –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã—Ç.")
            browser.quit()
            break
        else:
            print("‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.")

# ==========================================================
# üöÄ –ó–ê–ü–£–°–ö –ü–†–û–ì–†–ê–ú–ú–´
# ==========================================================
if __name__ == "__main__":
    main()
